# 没有块级作用域

在其他类C 的语言中，由花括号封闭的代码块都有自己的作用域。

在ES6之前，JavaScript 没有块级作用域经常会导致理解上的困惑。

```javascript
if (true) {
  var color = "blue";
}
alert(color); //"blue"
```

这里是在一个if 语句中定义了变量color。如果是在C、C++或Java 中，color 会在if 语句执行完毕后被销毁。但在JavaScript 中，if 语句中的变量声明会将变量添加到当前的执行环境（在这里是全局环境）中。

**_声明变量_**

使用var 声明的变量会自动被添加到最接近的环境中。在函数内部，最接近的环境就是函数的局部环境；在with 语句中，最接近的环境是函数环境。如果初始化变量时没有使用var 声明，该变量会自动被添加到全局环境。

**_查询标识符_**

当在某个环境中为了读取或写入而引用一个标识符时，必须通过搜索来确定该标识符实际代表什么。搜索过程从作用域链的前端开始，向上逐级查询与给定名字匹配的标识符。

如果在局部环境中找到了该标识符，搜索过程停止，变量就绪。

如果在局部环境中没有找到该变量名，则继续沿作用域链向上搜索。搜索过程将一直追溯到全局环境的变量对象。

如果在全局环境中也没有找到这个标识符，则意味着该变量尚未声明。

变量查询也不是没有代价的。很明显，访问局部变量要比访问全局变量更快，因为不用向上搜索作用域链。

JavaScript 引擎在优化标识符查询方面做得不错，因此这个差别在将来恐怕就可以忽略不计了。
